#!/bin/zsh

# Upload the currently-copied image URL to i.gabebw.com
#
# USAGE:
#
# No arguments means "download the URL I just copied":
#
#   icopy
#
# Download the URL in the pasteboard and upload as flip.jpg:
#
#   icopy flip.jpg

set -e

url="$(pbpaste)"

if (( $# == 0 )); then
  filename_on_server="$(basename "$url")"
elif (( $# == 1 )); then
  filename_on_server="$1"
fi

local_filename="$(basename "$filename_on_server")"

curl -o "$local_filename" "$url"
upload-image "$local_filename" "$filename_on_server"
rm "$local_filename"
