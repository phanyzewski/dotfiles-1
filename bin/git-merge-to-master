#!/bin/zsh

# Merge current branch into master, only if it's a fast-forward.
# Stays on the same branch if it's not a fast-forwward merge.

function update-master() {
  git checkout master && git pull origin master && git checkout -
}

update-master

if [[ $(git rev-parse master) == $(git merge-base HEAD origin/master) ]]; then
  git checkout master && git merge HEAD@{1} && git push && git bd $(git rev-parse --abbrev-ref @{-1})
else
  echo "Non-fastforward, or master behind origin/master"
fi
